---
# Mail server deployment playbook
# Usage: ansible-playbook -i inventory.yml mail.yml
#
# Requires 1Password CLI (op) authenticated and item 'stalwart-admin' in Infrastructure vault
# with fields: username, password

- name: Deploy Stalwart Mail Server
  hosts: mail
  become: true
  vars:
    stalwart_domain: jasonernst.com
    stalwart_hostname: mail.jasonernst.com
    # Admin credentials from 1Password (Infrastructure vault)
    stalwart_admin_user: "{{ lookup('community.general.onepassword', 'stalwart-admin', field='username', vault=onepassword_vault) }}"
    stalwart_admin_password: "{{ lookup('community.general.onepassword', 'stalwart-admin', field='password', vault=onepassword_vault) }}"
  roles:
    - stalwart
